{% extends 'layout.html' %}
{% block content %}
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="page-hero">
        <div class="d-flex align-items-center gap-3">
          <div class="me-2 display-6 text-primary"><i class="bi bi-tools"></i></div>
          <div>
            <h2 class="hero-title">Report an Issue â€” Community Maintenance</h2>
            <p class="hero-sub">Share details to help the community maintain shared spaces. You can file anonymously.</p>
          </div>
        </div>
      </div>

      <div class="card mt-3">
        <div class="card-body">
          <form method="post" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="mb-3">
              <label class="form-label">Name <small class="text-muted">(optional)</small></label>
              <input class="form-control" type="text" name="name" placeholder="Your name">
            </div>
            <div class="row">
              <div class="mb-3 col-md-6">
                <label class="form-label">Room <small class="text-muted">(optional)</small></label>
                <input class="form-control" type="text" name="room" placeholder="e.g. 2B-103">
              </div>
              <div class="mb-3 col-md-6">
                <label class="form-label">Title</label>
                <input class="form-control" type="text" name="title" required placeholder="Short summary of the issue">
              </div>
            </div>
            <div class="row">
              <div class="mb-3 col-md-8">
                <label class="form-label">Address <small class="text-muted">(where the issue is located)</small></label>
                <input class="form-control" type="text" name="address" placeholder="Street, building, area">
              </div>
              <div class="mb-3 col-md-4">
                <label class="form-label">Phone <small class="text-muted">(optional)</small></label>
                <input class="form-control" type="tel" name="phone" placeholder="Mobile or landline">
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description" rows="6" required placeholder="Explain the problem and any details that help"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Image (optional)</label>
              <input class="form-control" type="file" name="image" accept="image/*" id="imageInput">
              <div class="form-text">Upload a photo to illustrate the issue (helpful for quick triage).</div>
            </div>
            <div class="mb-3" id="previewBox" style="display:none;">
              <label class="form-label">Preview</label>
              <div><img id="imgPreview" src="#" alt="Preview" class="img-fluid rounded" style="max-height:300px;"></div>
            </div>
            <div class="d-flex justify-content-end">
              <button class="btn btn-lg btn-primary" type="submit"><i class="bi bi-send-fill me-1"></i> Submit Report</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script>
    const input = document.getElementById('imageInput');
    const previewBox = document.getElementById('previewBox');
    const imgPreview = document.getElementById('imgPreview');
    if (input) {
      input.addEventListener('change', e => {
        const f = e.target.files && e.target.files[0];
        if (!f) { previewBox.style.display = 'none'; return; }
        const url = URL.createObjectURL(f);
        imgPreview.src = url;
        previewBox.style.display = 'block';
      });
    }
  </script>
{% endblock %}
